---
- name: Clone iTrust repo
  git:
    repo: 'https://{{ githubuser | urlencode }}:{{ githubpassword | urlencode }}@github.ncsu.edu/vsingh7/iTrust2-v4'
    dest: "{{ itrust_dest }}"

- name: 'Checkout new branch'
  shell: 'git checkout fuzzer'
  args:
    chdir: "{{ itrust_dest }}"

- name: Run Py script
  script: fuzzer_script.py {{ itrust_dest }}
  register: output

- name: 'Git config user in web'
  shell: git config --global user.email {{ githubemail | urlencode }}

- name: 'Git config password in web'
  shell: git config --global user.password "{{ githubpassword | urlencode }}"

- name: 'Commit changed files in Git'
  shell: git add ./* && git commit -m "Fuzzer commit test" && git log --oneline
  args:
    chdir: "{{ itrust_dest }}"
  register: commitHash

- debug: var=commitHash.stdout_lines[0].split(']')[0].split(' ')[1]

- Call Jenkins Job Builder

- name: 'Reset Commit on Git'
  shell: git reset {{ commitHash.stdout_lines[0].split(']')[0].split(' ')[1] }}
  args:
    chdir: "{{ itrust_dest }}"
  register: output

- debug: var=output.stdout_lines
